<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>StockRiskTracker - Guest</title>

    {% load static %}
    <link rel="stylesheet" href="{% static 'css/index.css' %}">
</head>

<body>

    <div class="container">

        <div class="sidebar">
            <div class="logo-section">
                <div class="logo">ðŸ“ˆ</div>
                <h2>StockRiskTracker</h2>
            </div>
            <a href="/" class="active">Home</a>
            <!-- Protected pages redirect guests to login -->
            <a href="{% url 'login' %}?next={% url 'watchlist' %}">Watchlist</a>
            <a href="{% url 'login' %}?next={% url 'history' %}">History</a>
            <!-- Dictionary is public (top-level for guests) -->
            <a href="/dictionary">Dictionary</a>
            <a href="{% url 'login' %}" class="logout-btn">Login</a>
        </div>

        <div class="main">
            <div class="header-top">
                <h1>Welcome â€” Guest</h1>
                <div class="profile-section" style="position: relative;">
                    <!-- Guests see an avatar that opens a small menu with Login / Sign Up -->
                    <a href="#" id="guestProfileAvatar" onclick="toggleProfileMenu(event)"><img src="{% static 'image/profile.jpg' %}" alt="Profile" class="profile-avatar"></a>

                    <div id="guestProfileMenu" style="display:none; position:absolute; right:0; top:48px; background:#fff; border:1px solid #ddd; padding:8px; box-shadow:0 4px 12px rgba(0,0,0,0.08); border-radius:6px; z-index:1000; min-width:140px; text-align:center;">
                        <a class="guest-profile-btn" href="{% url 'login' %}" style="display:inline-block;margin:6px 0;padding:8px 12px;background:#0b5ed7;color:#fff;border-radius:4px;text-decoration:none;">Login</a>
                        <a class="guest-profile-btn" href="{% url 'register' %}" style="display:inline-block;margin:6px 0;padding:8px 12px;background:#6c757d;color:#fff;border-radius:4px;text-decoration:none;">Sign Up</a>
                    </div>
                </div>
            </div>


            <div class="watchlist">
                <h3>Stocks (Preview)</h3>

                <div class="stock-cards-horizontal">
                    <div class="stock-card safe" onclick="guestRedirect('/report?stock=Reliance')" style="cursor: pointer;">
                        <div class="card-header">
                            <img src="{% static 'image/reliance-logo.png' %}" alt="Reliance" class="company-logo">
                            <h4>Reliance</h4>
                        </div>
                        <p class="price">â‚¹ 2,456.80</p>
                        <p class="status">SAFE</p>
                    </div>

                    <div class="stock-card risky" onclick="guestRedirect('/report?stock=Adani%20Power')" style="cursor: pointer;">
                        <div class="card-header">
                            <img src="{% static 'image/adani-logo.png' %}" alt="Adani Power" class="company-logo">
                            <h4>Adani Power</h4>
                        </div>
                        <p class="price">â‚¹ 312.40</p>
                        <p class="status">RISKY</p>
                    </div>

                    <div class="stock-card safe" onclick="guestRedirect('/report?stock=TCS')" style="cursor: pointer;">
                        <div class="card-header">
                            <img src="{% static 'image/tcs-logo.jpg' %}" alt="TCS" class="company-logo">
                            <h4>TCS</h4>
                        </div>
                        <p class="price">â‚¹ 3,340.00</p>
                        <p class="status">SAFE</p>
                    </div>
                </div>

            </div>

        </div>

    </div>

    <script>
        // Guests: redirect protected actions to login with next param
        function guestRedirect(path) {
            const loginUrl = '{% url "login" %}';
            window.location.href = loginUrl + '?next=' + encodeURIComponent(path);
        }
        
        // Toggle small profile menu for guests (Login / Sign Up)
        function toggleProfileMenu(e) {
            e.preventDefault();
            const menu = document.getElementById('guestProfileMenu');
            if (!menu) return;
            menu.style.display = (menu.style.display === 'block') ? 'none' : 'block';
        }

        // Hide the profile menu when clicking outside
        document.addEventListener('click', function(event) {
            const menu = document.getElementById('guestProfileMenu');
            const avatar = document.getElementById('guestProfileAvatar');
            if (!menu || !avatar) return;
            if (menu.style.display === 'block' && !menu.contains(event.target) && !avatar.contains(event.target)) {
                menu.style.display = 'none';
            }
        });
    </script>

</body>

</html>